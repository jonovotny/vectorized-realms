---
layout: post
title: Mountains Pt. 2 - Reaching the top
date: 2024-07-23
published: false
---

We are back in the mountain terrain and in the [last post about it](/vectorized-realms/mountains/) I was pretty confident with my approximation of its 3.5e visual style. However, "Theory and practice sometimes clash. And when that happens, theory loses. Every single time." (L. Thorvalds, 2009). After trying out my design on more complex mountains, I found that tight turns of the flank geometry were rather common and caused notable fanning and self-intersections within the dotted flank lines. Even with significant manual optimization the results were not convincing. Drawing each flank line as individual line object allows for more fine grained control of the line placement at the cost of increasing the data size. Given that single mountains can contain more than 150 flank lines this increase might have some inpact on the svg size, but at this point I do not see a way around it.

With that in mind, here are the tasks that need to be solved:

* How to select initial flank line positions based on the outline of a mountain and a given main ridge?
* How to adjust this automatic selections to conform to the initial map data (since no heuristic will be able to predict the hand-drawn style in all cases)
* Come up with a way to annotate/generate the required data within an svg drawing software (i.e. Inkscape)

# Connecting "Outer" and "Inner"

Going back to a very simple example, a basic mountain is defined by an outline polygon and a polyline marking its ridge (We will ignore branching side ridges for now). Flank lines start at the outline, end at the ridge and are placed roughly equidistant from each other, while following the mountain's shape. A notable exception are the ridge end points, where several flank lines join at (or at least every close to) the end of the polyline. 

One way of simplifying this situation is to treat the ridge line as a polygon with no area. One side of this polygon follows the ridgeline from e.g. the upper endpoint to the lower one, and the other side follows the ridge in reverse, ending at the starting point. Now we have an outer and an inner polygon with the task to draw lines from one to the other. A naive approach would be to define a single flank line as starting points on the inner and outer polygon, then subdivide each polygon into the same number of pieces and then draw the connections between these subdivisions.

<!--more-->

It's a decent start and, close to the starting flank, things seem to work. However, since the outer polygon does not perfectly follow the shape of the ridge, flank lines get out of sync the farther away they are from the defined starting point. This is a problem in regions where the outline meanders a lot. At ridge end points, this naive approach does not allow multiple flank lines to end at a single point. We clearly need more control, so let's add additional "guide" flank lines. This way we can split the inner and outer polygons into multiple sections. E.g., if the section on the ridge polygon is much shorter than on the outline, a fan like flank line layout can be achieved.

Of course we now need to adjust the distance between flank lines based on the longer one of inner and outer lines in each segment, to ensur a somewhat consistent placement. This makes the spread of flank lines more even, but some problems still remain. Especially in fan-shaped sections, the lines get very close to each other. In the original map style this is handled by shortening lines to keep adequate distance.

